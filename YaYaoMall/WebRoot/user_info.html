<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>用户信息</title>

    <link href="resources/css/bootstrap.min.css" rel="stylesheet">
    <link href="resources/css/style.css" rel="stylesheet">
  </head>
  <body>
   <div class="person-common-header">
  	<div><a class="pull-left" href="person.html">&lt;返回</a></div>
  	<div class="text-center person-common-header-center">用户信息</div>
  </div>
  
   <input type="file" id="fileUserInfoIMG" accept="image/*" style="display: none;"/>
  <ul class="list-group person-userinfo">
   <li class="list-group-item person-userinfo-img" id="updateUserInfoIMG">
   头像 
   <span class="pull-right">&gt;</span>
   <div>
   <img id="userInfoIMG" alt="" src="resources/img/preLoding.jpg">
   </div>
   </li>
   <li class="list-group-item" id="updateUserInfoNiceName">
   昵称
   <span class="pull-right">&gt;</span>
   <div id="userInfoNiceName"></div>
   </li>
   <li class="list-group-item" id="updateUserSignature">
   个性签名
   <span class="pull-right">&gt;</span>
   <div id="userSignature"></div>
   </li>
   <li class="list-group-item" id="updateUserEmail">
   邮箱
   <span class="pull-right">&gt;</span>
   <div id="userEmail"></div>
   </li>
   <li class="list-group-item" id="updateUserPhone">
   手机号
   <span class="pull-right">&gt;</span>
   <div id="userPhone"></div>
   </li>
   <li class="list-group-item" id="updateUserIdentity">
   身份认证
   <span class="pull-right">&gt;</span>
   <div id="userIdentity"></div>
   </li>
   <li class="list-group-item" id="updateUserReceiptAddress">
   收货地址
   <span class="pull-right">&gt;</span>
   <div id="userReceiptAddress"></div>
   </li>
	</ul>
	<button class="btn btn-primary btn-block" id="userLoginOut">退出登陆</button>
	
	<!-- 按钮触发模态框 -->
<button class="hide" data-toggle="modal" 
   data-target="#myModal" id="mymodal">
</button>
	<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" 
   aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close" 
               data-dismiss="modal" aria-hidden="true" id="closeModal">
                  &times;
            </button>
            <h4 class="modal-title" id="myModalLabel">
            </h4>
         </div>
         <div class="modal-body">
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="submit">
               提交
            </button>
         </div>
      </div><!-- /.modal-content -->
</div><!-- /.modal -->
</div>

	</body>
       <script src="resources/js/jquery2.1.js"></script>  
       <script src="resources/js/bootstrap3.2.0.js"></script>
       <script src="resources/js/sha1.js"></script>
       <script src="resources/js/base.js"></script>
       <script type="text/javascript">
      		$(function(){
      			//登录成功的用户信息
      			if(localStorage.getItem("loginstate")==1){
      				document.querySelector("#userInfoIMG").src=userData.userPerson.userIMG||userData.userInit.userIMG;
      				document.querySelector("#userInfoNiceName").innerHTML=userData.userPerson.userNiceName||userData.userInit.userNiceName;
      				document.querySelector("#userSignature").innerHTML=userData.userPerson.userSignature||userData.userInit.userSignature;
      				document.querySelector("#userEmail").innerHTML=userData.userPerson.userEmail||userData.userInit.userEmail;
      				document.querySelector("#userPhone").innerHTML=userData.userPerson.userPhone||userData.userInit.userPhone;
      				document.querySelector("#userIdentity").innerHTML=userData.userPerson.userIdentity||userData.userInit.userPerson;
      				document.querySelector("#userReceiptAddress").innerHTML=userData.userPerson.userReceiptAddress||userData.userInit.userReceiptAddress;
      			}else{
      				location.replace("person.html");
      			}
      		//登录退出
      		$("#userLoginOut").on(myTouchEvents.touchstart,function(){
      			localStorage.removeItem("loginstate");
      			localStorage.removeItem("userName");
      			localStorage.removeItem("userPassword");
      			myUtils.myPrevToast("退出成功",function(){
      			location.replace("person.html");
      			});
      		});
  			/* //获取移动的物体
  			$("#userInfoIMG").on(myTouchEvents.touchstart,function(event){
  				var x=0,y=0;
      		myTouchEvents.touchstart=='touchstart'?(x=event.originalEvent.targetTouches[0].pageX) && (y=event.originalEvent.targetTouches[0].pageY):(x=event.pageX) && (y=event.pageY);
      			thistouchmove();
      			$("#userInfoIMG").css({"position":"fixed","left":(x-parseInt($("#userInfoIMG").css("width"))/2)+'px',"top":(y-parseInt($("#userInfoIMG").css("width"))/2)+'px',"z-index":"99999"});
      		});
  		  		//在整个页面移动物体
  		  		function thistouchmove(){
  		  			$("html").on(myTouchEvents.touchmove,function(event){
  		  				event.preventDefault();
  		  				var x=0,y=0;
  		      		myTouchEvents.touchmove=='touchmove'?(x=event.originalEvent.targetTouches[0].pageX) && (y=event.originalEvent.targetTouches[0].pageY):(x=event.pageX) && (y=event.pageY);
  		      		
  		      		$("#userInfoIMG").css({"left":(x-parseInt($("#userInfoIMG").css("width"))/2)+'px',"top":(y-parseInt($("#userInfoIMG").css("width"))/2)+'px'});
  		  			});
  		  		}
  		      		//释放物体
  		  			$("html").on(myTouchEvents.touchend,function(event){
  		      		$("#userInfoIMG").css({"left":parseInt($("#userInfoIMG").css("left"))+'px',"top":parseInt($("#userInfoIMG").css("top"))+'px'});
  		  				$("html").off(myTouchEvents.touchmove);
  		  			}); */
  		  		//修改头像
  		  		$("#updateUserInfoIMG").on('click',function(){
  		  			$("#fileUserInfoIMG").trigger('click');
  		  		});
  		  		$("#fileUserInfoIMG").change(function(){
  		  			var file=document.querySelector("#fileUserInfoIMG");
  		  		  photoExt=file.value.substr(file.value.lastIndexOf(".")).toLowerCase();//获得文件后缀名
  				//判断照片格式
  				  if(photoExt!='.jpg'&&photoExt!='.png'){
  				     alert("请上传后缀名为jpg/png的照片!");
  				      return false;
  				  }
  				  var fileSize = 0;
  				  var isIE = /msie/i.test(navigator.userAgent) && !window.opera;            
  				  if (isIE && !file.files) {          
  				       var filePath = file.value;            
  				       var fileSystem = new ActiveXObject("Scripting.FileSystemObject");   
  				       var file = fileSystem.GetFile (filePath);               
  				       fileSize = file.Size;         
  				  }else {  
  				       fileSize = file.files[0].size;     
  				  } 
  				  fileSize=Math.round(fileSize/1024*100/1024)/100; //单位为MB
  				  if(fileSize>=2){
  				      alert("图片大小为"+fileSize+"MB，超过最大尺寸为2MB，请重新上传!");
  				      return false;
  				  }		  
  			    	if (file.files && file.files[0])  
  			    	 {
  			         var reader = new FileReader(); 
  			      	reader.onload = function(e){
  			      		console.log(e.target.result);
  			      		myUtils.myPrevToast("上传中···",function(){
  			      		$("#userInfoIMG").attr("src",e.target.result);
  			      		});
  			    	}
  			      	reader.readAsDataURL(file.files[0]);
  				  console.log(file.files[0]);
  			      }else{
  			    	$("#userInfoIMG").attr("src",file.value);
  			      }
  		  			
  		  		});
  		  		//修改昵称
  		  		$('#updateUserInfoNiceName').click(function(){
  		  			$('#mymodal').click();
  		  			$('#myModalLabel').text("修改昵称");
  		  			$('.modal-body').html("<input type='text' class='form-control' placeholder='"+$('#userInfoNiceName').text()+"' id='userInfoNiceNameModal'/>");
  		  		$('#submit').click(function(){
  		  		$('#userInfoNiceName').text($('#userInfoNiceNameModal').val());
  		  		$('#closeModal').click();
  		  			console.log($('#userInfoNiceNameModal').val());
  		  		});
  		  		});
  		  		//ahover
  		  		   myUtils.ahover();
      		});
       </script>
</html>
